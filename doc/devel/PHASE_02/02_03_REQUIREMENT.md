# 要件定義書 - vsmatrix PHASE 2

## 目的

本文書では、vsmatrix PHASE2 MVP(Minimum Viable Product) の開発に必要な要件を定義します。
次のPHASEへのたたき台となるとともに、最低限の実動作が実現できるかを確認します。
最低限の実動作とは、入力および出力VAIF(仮想オーディオインターフェース)の間に仮想的なパッチケーブルを接続し、
出力VAIFから入力VAIFへ音声が流れることを確認します。

## 概要
### 機能概要

PHASE 2では設定ファイルは使わず、出力VAIF(仮想オーディオインターフェース)1個と入力VIAF1個を生成します。出力VAIFへの外部アプリからの入力値を入力VIAFに受け渡す、仮想的なパッチケーブルを作成します。外部アプリでは、これらのVAIFを入力や出力に設定でき、出力をループバックできます。PHASE2はコマンドではなく、仮想AIFのデバイスドライバとして実現します。

### ペルソナと特性

ユーザーは開発者(lulliecat)1人とします。今後の開発の足掛かりとしてのみ使います。

### 動作環境

Windows11 Pro x64環境で動作します。

### 前提条件

デバイスドライバの署名はテストのものを使います。

### 制約条件

未検討です。

## 機能要件

### FR-01: ドライバ初期化機能
- 優先度: 必須
- 説明: ドライバを初期化し、仮想デバイスの作成に備えます。
- 詳細:
  - register, PnP, power management回りの最低限のコード

### FR-02: 仮想デバイス作成機能
- 優先度: 必須
- 説明: VAIF1_INPUTという名前の仮想入力AIFと、VAIF1_OUTPUTという名前の仮想出力AIFを作成します。
- 詳細:
  - デバイスの新規作成

### FR-03: 仮想デバイス間QUEUEの作成機能
- 優先度: 必須
- 説明: VAIF1_OUTPUTからVAIF1_INPUTへQUEUEを接続し、音声を受け渡します。
- 詳細:
  - QUEUEを作成してデバイス間に接続します
  - 入力・出力・もしくは両方にリングバッファorダブルバッファを挿入することを検討します。必要であれば導入します。

## 非機能要件

## UI要件

## 受け入れ基準

- 2つのVAIFを併用して、マイクから入力した音声がスピーカーから出ることを確認します。以下の構成で動作することを確認します。
  - (マイク) -> NVIDIA Bloadcast(Audio IN) -> (VAIF1_OUTPUT) ~ (VAIF1_INPUT) -> OBS Studio(Audio Out)
- 再起動しても、上記設定で音声が流れることを確認します。
